<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini YouTube ë™ì˜ìƒ ìš”ì•½</title>
    <style>
        body { font-family: 'Arial', sans-serif; margin: 20px; background-color: #f4f4f9; color: #333; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #4CAF50; }
        .input-form { display: flex; margin-bottom: 20px; }
        .input-form input[type="text"] { flex-grow: 1; padding: 10px; border: 2px solid #ddd; border-radius: 5px 0 0 5px; font-size: 16px; }
        .input-form button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 0 5px 5px 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        .input-form button:hover { background-color: #45a049; }
        #loading { text-align: center; color: #777; display: none; margin-top: 20px; }
        #results-container { margin-top: 30px; padding: 20px; border: 1px solid #eee; border-radius: 5px; background: #fafafa; }
        #summary-output a { cursor: pointer; color: #1e88e5; text-decoration: none; font-weight: bold; }
        #summary-output a:hover { text-decoration: underline; }
        .video-player { margin-bottom: 20px; aspect-ratio: 16 / 9; max-width: 100%; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ Gemini YouTube ìš”ì•½ ì„œë¹„ìŠ¤</h1>
        <p>ìš”ì•½í•˜ê³ ì í•˜ëŠ” YouTube ë™ì˜ìƒì˜ URLì„ ì…ë ¥í•˜ê³  ìš”ì•½ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
        
        <div class="input-form">
            <input type="text" id="youtubeUrl" placeholder="YouTube ë™ì˜ìƒ URL (ì˜ˆ: https://www.youtube.com/watch?v=...)">
            <button onclick="getSummary()">ìš”ì•½ ìƒì„±</button>
        </div>

        <div id="loading">... AIê°€ ë™ì˜ìƒì„ ë¶„ì„í•˜ê³  ìš”ì•½ì„ ìƒì„±í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš” ...</div>

        <div id="results-container" style="display:none;">
            <div class="video-player">
                <iframe id="videoIframe" width="560" height="315" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div id="summary-output">
                </div>
        </div>
    </div>

    <script>
        // YouTube URLì—ì„œ ë¹„ë””ì˜¤ IDë¥¼ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
        function extractVideoId(url) {
            const regex = /(?<=v=)[\w-]+|(?<=youtu\.be\/)[\w-]+/;
            const match = url.match(regex);
            return match ? match[0] : null;
        }

        // íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (MM:SS -> Seconds)
        function timeToSeconds(timeString) {
            // [MM:SS-MM:SS] í˜•ì‹ì—ì„œ ì²« ë²ˆì§¸ MM:SSë§Œ ì¶”ì¶œ
            const match = timeString.match(/(\d{2}:\d{2})/);
            if (!match) return 0;
            
            const parts = match[0].split(':');
            const minutes = parseInt(parts[0], 10);
            const seconds = parseInt(parts[1], 10);
            return (minutes * 60) + seconds;
        }

        // ìš”ì•½ ìƒì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        async function getSummary() {
            const urlInput = document.getElementById('youtubeUrl');
            const youtubeUrl = urlInput.value.trim();
            const loading = document.getElementById('loading');
            const resultsContainer = document.getElementById('results-container');
            const summaryOutput = document.getElementById('summary-output');
            const videoIframe = document.getElementById('videoIframe');

            if (!youtubeUrl) {
                alert("YouTube URLì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
                return;
            }

            const videoId = extractVideoId(youtubeUrl);
            if (!videoId) {
                summaryOutput.innerHTML = "<h2>ğŸš¨ ì˜¤ë¥˜</h2><p>ìœ íš¨í•˜ì§€ ì•Šì€ YouTube URL í˜•ì‹ì…ë‹ˆë‹¤.</p>";
                return;
            }
            
            // UI ì´ˆê¸°í™” ë° ë¡œë”© í‘œì‹œ
            loading.style.display = 'block';
            resultsContainer.style.display = 'none';
            summaryOutput.innerHTML = '';
            
            // ìœ íŠœë¸Œ í”Œë ˆì´ì–´ ì„¤ì • (í´ë¦­ ì‹œ ì´ë™ì„ ìœ„í•´ enablejsapi=1 ì¶”ê°€)
            videoIframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1`;

            try {
                // Flask ì„œë²„ì˜ POST ì—”ë“œí¬ì¸íŠ¸ì— ìš”ì²­
                const response = await fetch('/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `url=${encodeURIComponent(youtubeUrl)}`
                });

                const data = await response.json();
                
                // ìš”ì•½ ê²°ê³¼ë¥¼ í‘œì‹œ
                summaryOutput.innerHTML = data.summary_html;
                
                // íƒ€ì„ìŠ¤íƒ¬í”„ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                attachTimestampListeners(videoId);

                // ê²°ê³¼ í‘œì‹œ
                resultsContainer.style.display = 'block';

            } catch (error) {
                summaryOutput.innerHTML = `<h2>ğŸš¨ í†µì‹  ì˜¤ë¥˜</h2><p>ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p>`;
                console.error('Error fetching summary:', error);
            } finally {
                loading.style.display = 'none';
            }
        }

        // íƒ€ì„ìŠ¤íƒ¬í”„ í´ë¦­ ì‹œ ë™ì˜ìƒìœ¼ë¡œ ì´ë™í•˜ëŠ” ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function attachTimestampListeners(videoId) {
            const summaryOutput = document.getElementById('summary-output');
            summaryOutput.querySelectorAll('a[data-time]').forEach(link => {
                // ê¸°ì¡´ì˜ data-time ì†ì„± ëŒ€ì‹ , innerTextì—ì„œ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì¶”ì¶œ
                const timeInSeconds = timeToSeconds(link.innerText);
                
                // ìƒˆë¡œìš´ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •
                link.onclick = (e) => {
                    e.preventDefault();
                    // YouTube Iframe APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì˜ìƒ ì´ë™ (iframe.srcë¥¼ ì§ì ‘ ë³€ê²½)
                    const iframe = document.getElementById('videoIframe');
                    iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&start=${timeInSeconds}`;
                };
            });
        }
    </script>
</body>
</html>
